# OpenAI SDK to Yandex GPT Translator

[![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=flat-square)](http://makeapullrequest.com)
![Test Status](https://github.com/all-mute/openai2yandex_translator/actions/workflows/docker-image.yml/badge.svg)
![Test Status](https://github.com/all-mute/openai2yandex_translator/actions/workflows/python-app.yml/badge.svg)
![Vercel](https://vercelbadge.vercel.app/api/all-mute/openai2yandex_translator)

- [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)
    - [–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏](#–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ-–º–æ–¥–µ–ª–∏)
    - [–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è](#–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
        - [–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å folder_id –∏ api_key?](#–∫–∞–∫-–ø–æ–ª—É—á–∏—Ç—å-folder_id-–∏-api_key)
    - [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π gpt-4 –∫–∞–∫ YandexGPT](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-–º–æ–¥–µ–ª–µ–π-gpt-4-–∫–∞–∫-yandexgpt)
    - [–ü–ª–∞–Ω—ã](#–ø–ª–∞–Ω—ã)
- [–î–µ–ø–ª–æ–π](#–¥–µ–ø–ª–æ–π)
    - [–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å–ª—è—Ç–æ—Ä—ã (–±–µ–∑ –¥–µ–ø–ª–æ—è)](#–∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ-—Ç—Ä–∞–Ω—Å–ª—è—Ç–æ—Ä—ã-–±–µ–∑-–¥–µ–ø–ª–æ—è)
    - [–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –Ω–∞ vercel](#–±—ã—Å—Ç—Ä—ã–π-–∑–∞–ø—É—Å–∫-–Ω–∞-vercel)
    - [–õ–æ–∫–∞–ª—å–Ω—ã–π/–æ–±–ª–∞—á–Ω—ã–π –∑–∞–ø—É—Å–∫](#–ª–æ–∫–∞–ª—å–Ω—ã–π-–æ–±–ª–∞—á–Ω—ã–π-–∑–∞–ø—É—Å–∫)
    - [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç—ã)
- [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)


–≠—Ç–æ –ª–∞–∫–æ–Ω–∏—á–Ω–æ–µ fastapi –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø—Ä–æ–∫—Å–∏), –∫–æ—Ç–æ—Ä–æ–µ —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã OpenAI<->Yandex Cloud Foundational Models, —á—Ç–æ–±—ã —Å–µ—Ä–≤–∏—Å—ã Yandex Cloud –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞—Ö —á–µ—Ä–µ–∑ OpenAI SDK. 

–ù–∞–ø—Ä–∏–º–µ—Ä:

```python
import openai

# –° –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∑–∞–ø—Ä–æ—Å–∞
client = openai.Client(api_key=f"{FOLDER_ID}@{API_KEY_OR_IAM_KEY}", base_url=f"{proxy_url}/v1/")
# –ò–ª–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
client = openai.Client(api_key=f"sk-my", base_url=f"{proxy_url}/v1/")
```

*–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SDK –Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ, –≤ —Ç–æ–º —á–∏—Å–ª–µ js, go, –∏ —Ç.–¥.*

–°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

- üöÄ —Ä–∞–±–æ—Ç–∞ —Å yandexGPT –∏–∑ no-code —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ —à–∏—Ä–æ–∫–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è (n8n, langflow, flowise –∏ —Ç.–¥.)
- üß∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ Open Source —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞—Ö (langchain, llamaindex)
- üß© —Ä–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã –¥–ª—è Obsidian, Notion –∏ —Ç.–¥.)

*–ü—Ä–∏–Ω–æ—Å–∏—Ç–µ —Å–≤–æ–∏ –ø—Ä–∏–º–µ—Ä—ã —É–¥–∞—á–Ω—ã—Ö –∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –≤ issues!*

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

```python
# –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
client.chat.completions.create(
        messages=[
            {
                "role": "user",
                "content": '–í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª –æ—Å–Ω–æ–≤–∞–Ω –Ø–Ω–¥–µ–∫—Å?',
            }
        ],
        model="yandexgpt/latest", 
        # –∏–ª–∏ f'gpt://{FOLDER_ID}/yandexgpt/latest' 
        # –∏–ª–∏ f'ds://{MODEL_ID}'
        max_tokens=2000,
        temperature=0.1,
    )
    
# —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —Ç–µ–∫—Å—Ç–∞
client.embeddings.create(input = ['–í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª –æ—Å–Ω–æ–≤–∞–Ω –Ø–Ω–¥–µ–∫—Å?'], model='text-search-doc/latest').data[0].embedding # –∏–ª–∏ model=f'emb://{FOLDER_ID}/text-search-doc/latest'
```

–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –≤ —Ñ–∞–π–ª–∞—Ö [example.py](examples/example.py) –∏ [example.js](examples/example.js).

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏:

* –í—Å–µ –º–æ–¥–µ–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞, uri –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `gpt://`
* –í—Å–µ Embedding –º–æ–¥–µ–ª–∏, uri –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `emb://`
* –í—Å–µ –¥–æ–æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞, uri –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `ds://`
* –í—Å–µ –¥–æ–æ–±—É—á–µ–Ω–Ω—ã–µ Embedding –º–æ–¥–µ–ª–∏, uri –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `ds://` (–ø–æ–∫–∞ —Ç–∞–∫–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –Ω–µ—Ç –≤ Yandex Cloud)

–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã, function calling, logprobs –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è.

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

* **–ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–æ–∫—Å–∏.** –ï—Å–ª–∏ –æ–ø–µ–Ω–∞–∏ –∫–ª—é—á –≤ –∑–∞–ø—Ä–æ—Å–µ —É–∫–∞–∑–∞—Ç—å `sk-my`, ` ` –∏–ª–∏ –ø—É—Å—Ç—ã–º, —Ç–æ –∫—Ä–µ–¥–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Yandex Cloud –±—É–¥—É—Ç –∏—Å–∫–∞—Ç—å—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ó–∞–¥–∞–π—Ç–µ –∏—Ö –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç—Ç–∏–º —Å—Ü–µ–Ω–∞—Ä–∏–µ–º –≤ `.env` –∏–ª–∏ `Dockerfile`.

* **–ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.** –ï—Å–ª–∏ –≤ –¥–∞–Ω–Ω—É—é –ø—Ä–æ–∫—Å—é –±—É–¥–µ—Ç —Ö–æ–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ç–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ OpenAI –∫–ª—é—á–∞ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ folder_id –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–ø–∏-–∫–ª—é—á –∏–ª–∏ IAM-–∫–ª—é—á, —Ä–∞–∑–¥–µ–ª—è—è –∏—Ö —Å–∏–º–≤–æ–ª–æ–º `@` (–Ω–∞–ø—Ä–∏–º–µ—Ä `folder_id@iam_key`).

#### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å folder_id –∏ api_key?

* [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—á–∞–ª—É —Ä–∞–±–æ—Ç—ã —Å YandexGPT](https://yandex.cloud/ru/docs/foundation-models/quickstart/yandexgpt#before-begin)
* [–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å IAM-—Ç–æ–∫–µ–Ω / API-–∫–ª—é—á –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–æ–ª–∏](https://yandex.cloud/ru/docs/foundation-models/api-ref/authentication#yandex-account_1)

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π gpt-4 –∫–∞–∫ YandexGPT

–ï—Å–ª–∏ –≤—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –≤ –≤—ã–±–æ—Ä–µ –º–æ–¥–µ–ª–µ–π, –Ω–æ –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å —Ö–æ—Ç—è-–±—ã api-–∫–ª—é—á –∏ base_url, —Ç–æ –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –º–æ–¥–µ–ª—è–º OpenAI - –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –º–∞–ø–∏—Ç—å—Å—è –Ω–∞ –º–æ–¥–µ–ª–∏ YandexGPT:
- gpt-4o -> yandexgpt/latest
- gpt-4o-mini -> yandexgpt-lite/latest
- text-embedding-3-large, text-embedding-3-small, text-embedding-ada-002 -> text-search-doc/latest

### –ü–ª–∞–Ω—ã

* ~~Tests~~
* ~~Logging~~
* ~~Error handling~~
* ~~–°—Ç—Ä–∏–º–∏–Ω–≥~~
* –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
* –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–æ–æ–±—É—á–µ–Ω–Ω—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
* –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É YandexART

## –î–µ–ø–ª–æ–π

### –ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å–ª—è—Ç–æ—Ä—ã (–±–µ–∑ –¥–µ–ø–ª–æ—è)

1. **Yandex Cloud**, `ru-central1-a`. Stateless —Ä–µ–∂–∏–º, –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è. https://apps.llmplay.space/translator Status: ![Yandex Offline](https://apps.llmplay.space/translator/badge)

2. **Vercel** https://openai2yandex-translator.vercel.app Status: ![Vercel Offline](https://openai2yandex-translator.vercel.app/badge)


### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –Ω–∞ vercel:

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2Fall-mute%2Fyagpt2openai_translator)

- –£–∫–∞–∂–∏—Ç–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è `VERCEL=True`, function max duration 30 —Å–µ–∫—É–Ω–¥ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Ä–µ–¥–µ–ø–ª–æ–π.
- –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ `FOLDER_ID` & `YANDEX_API_KEY` –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–µ–ø–ª–æ—è.

### –õ–æ–∫–∞–ª—å–Ω—ã–π/–æ–±–ª–∞—á–Ω—ã–π –∑–∞–ø—É—Å–∫

1. –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (in `.env` file, Dockerfile or cloud environment):
    - `FOLDER_ID`: your Yandex Cloud folder id
    - `YANDEX_API_KEY`: your Yandex Cloud API key
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
    - `docker-compose up -d --build`. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É 127.0.0.1:**9041**
    - –∏–ª–∏ (–∫–æ–º–∞–Ω–¥—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã –¥–ª—è `podman`) `docker build -t image_name .`, –∑–∞—Ç–µ–º `docker run -d -p 127.0.0.1:9041:9041 --name container_name image_name` 
    - –∏–ª–∏ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) `pip install -r requirements.txt`, –∑–∞—Ç–µ–º `python app/main.py`

–ú–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ: [–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Yandex Serverless Containers](https://yandex.cloud/ru/docs/tutorials/serverless/deploy-app-container)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
curl -X POST <PROXY_URL>/v1/chat/completions \
-H "Authorization: Bearer <FOLDER>@<IAM_OR_API>" \
-H "Content-Type: application/json" \
-d '{
    "model": "yandexgpt/latest",
    "messages": [
        {"role": "user", "content": "–í –∫–∞–∫–æ–º –≥–æ–¥—É –ì–∞–≥–∞—Ä–∏–Ω –ø–æ–ª–µ—Ç–µ–ª –≤ –∫–æ—Å–º–æ—Å?"},
        {"role": "assistant", "content": "–í 1961."},
        {"role": "user", "content": "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–ª—Å—è –∫–æ—Ä–∞–±–ª—å?"}
    ]
}'
```

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø–æ —Ä–∞–±–æ—Ç–µ —Å —ç—Ç–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, **–ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ issue** –≤ —ç—Ç–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –æ–Ω –∞–∫—Ç–∏–≤–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –û–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ –ø–æ –ø—Ä–æ–±–ª–µ–º–∞–º –ø–∏—Å–∞—Ç—å tg `@nongilgameshj`

* –ß—Ç–æ–±—ã —Ö–æ–¥–∏—Ç—å –≤ –¥–æ–æ–±—É—á–µ–Ω–Ω—É—é gpt, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å/—Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞ DataShpere —Å —Ä–æ–ª—å—é `developer`
* –ü—Ä–∏ –¥–µ–ø–ª–æ–µ —á–µ—Ä–µ–∑ serverless –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (vervel, yc functions) –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –≤—ã—Å—Ç–∞–≤–∏—Ç—å timeout 30 —Å–µ–∫—É–Ω–¥
